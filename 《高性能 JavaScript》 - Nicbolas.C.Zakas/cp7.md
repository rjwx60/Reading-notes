## 数据传输：

Ajax是高性能JS的基础，它通过延迟加载体积较大的资源文件来让页面加载速度更快
选择合适的传输方式和最有效的数据格式，能显著改善用户和网站的交互体验

### 向服务器请求数据：
#### XHR（XMLHttpRequest）
首选的、最常用的、最强大的数据请求技术  
缺点：处理大量数据会很慢、不能跨域请求数据  

#### 动态脚本注入
使用 Js 创建一个 script标签，设置src  

优点：能跨域请求数据  
优点：响应信息作为 Js 执行，而非字符串需要进一步处理，故速度非常快  

缺点：不能设置和访问请求头信息、不能设置请求的超时处理或重试、不能把整个响应信息作为字符串来处理、只能用 GET 方式  
缺点：无法直接控制返回代码的行为  
缺点：响应信息作为 script 标签的源码，必须是可执行的 Js 代码，不能用XML、JSON、或其他任何格式的数据  
缺点：无论哪种数据，都必须封装在一个回调函数中  

￼<!-- ![图1](https://github.com/rjwx60/Reading-notes/blob/master/%E3%80%8A%E9%AB%98%E6%80%A7%E8%83%BD%20JavaScript%E3%80%8B%20-%20Nicbolas.C.Zakas/imgs/7-01.png)   -->
<img src="https://github.com/rjwx60/Reading-notes/raw/master/%E3%80%8A%E9%AB%98%E6%80%A7%E8%83%BD%20JavaScript%E3%80%8B%20-%20Nicbolas.C.Zakas/imgs/7-01.png" alt="图1" width="300px">

#### multipartXHR
在服务器端，将各种资源打包成一个由双方约定的、字符串分割的长字符串，并发送到客户端，然后用 Js 处理，根据 mime-type 类型 和 传入的头信息，解析出每个资源    

优点：允许只用一个 HTTP 请求，从服务器端向客户端传送多个资源  
优点：适用于传输页面中大量用到的、但不需缓存的资源，尤其是图片  
优点：减少了 HTTP请求，才是最大的影响  

缺点：编写健壮的 MXHR 代码很复杂，但值得深入研究  
缺点：获取的资源不能被浏览器缓存  
缺点：老版本 IE 不支持  

#### Comet & iframes
用于极端情况，暂不讨论




### 向服务器端发送数据：
#### XHR
略过  

#### 图片信标
用Js创建 新 Image 对象，将 src属性 设置为服务器上脚本的 url  

优点：是向服务器回传数据的最快且最有效的方式，服务器不用发送任何响应正文  

缺点：无法 POST  
缺点：url 长度有限，发送数据有限  
缺点：客户端能接收到的响应类型有限  
缺点：监听服务器回传数据的方式较少，如监听 Image对象的 load 事件  

若需要返回大量数据给客户端，用XHR  
若只关心发送数据到服务器端，用图片信标  


### 数据结构
优劣取决于要传输的数据以及它在页面上的用途  

#### XML
缺点：极其冗长、每个单独的数据片段都依赖大量的结构、有效数据比例非常低
缺点：语法模糊、解析XML需要较大精力、慢、非常慢

#### JSON
优点：直接编写、轻量、易于解析
优点：体积小、数据占比却大、通用性佳 

#### HTML
缺点：臃肿、繁杂、慢
当客户端的瓶颈是CPU而不是带宽才使用

#### JSON-P 亦称 JSON 填充 P139-140

#### 自定义格式
采用自定义格式时，需要决定采用哪种分隔符
适用于在很短的时间内向客户端传送大量数据


#### 数据格式总结：P144 + P149

